#{extends 'masterTemplate.html' /}

#{set 'moreStyles'}
    <link rel="stylesheet" type="text/css" media="screen" href="@{'/public/stylesheets/messages.css'}" />
#{/set}

#{set 'moreScripts'}
    <script src="@{'/public/javascripts/usersPopupList.js'}" type="text/javascript" charset="${_response_encoding}"></script>
    <script src="@{'/public/javascripts/messages/messagesNew.js'}" type="text/javascript" charset="${_response_encoding}"></script>
    	
    <script type="text/javascript">
    
	    var profileMessagesChooseFromMyContactsPopupTitle = "&{'profileMessagesChooseFromMyContactsPopupTitle'}";
	    
	</script>
#{/set}


<div id="messagesContainer" class="messagesMainContainer">

	<div class="messagesNewError">
		<ul>
			<li><div class="errorMessage">#{error 'writtenMessage.toUserName' /}</div></li>
			<li><div class="errorMessage">#{error 'writtenMessage.messageContent' /}</div></li>
		</ul>
	</div>

	<div class="messagesNewError">
		<span class="errorMessage"></span>
	</div>

	#{form @messages.MessagesNew.doSendMessage() }
		<div id="messagesNewFormHeader">
			<table>
				<tbody>
					<tr>
						<td>
							&{'profileMessagesTo'}: 
							<input id="messagesTo" size="20" name="writtenMessage.toUserName" value="${flash['writtenMessage.toUserName']}" data-bind="value: messageRecipient" />
							<span id="choooseFromMyContactsLink" class="dabLinkLSpaced" data-bind="css:  {dabLinkLSpaced : isChooseLinkActive, dabLinkLSpacedDisabled : !isChooseLinkActive()}">&{'profileMessagesChooseFromMyContacts'}</span>
						</td>
					</tr>
					
					<tr>
						<td>
							&{'profileMessagesSubject'}: 
							<input  size="50"  name="writtenMessage.subject" value="${flash['writtenMessage.subject']}"  />
						</td>
					</tr>

					<tr>
						<td>
							<input type="submit" value="&{'profileMessagesSend'}"/>
						</td>
					</tr>
					
				</tbody>
			</table>
		</div>
		
		<textarea rows="10" class="messagesNewTextArea" name="writtenMessage.messageContent" >${flash['writtenMessage.messageContent']}</textarea>
	#{/form}
	
	#{dab.usersPopupList users:loggedinUserProfile.myActiveContactsSummaries /}

</div>